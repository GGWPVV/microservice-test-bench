version: "3.8"
services:
  user_service:
    build:
      context: ./projects/user_service/app
    ports:
      - "8000:8000"
    container_name: user_service
    environment:
      - DB_URL=postgresql://userpostgres:userpassword@userdb:5432/userdb
    depends_on:
      - userdb
    networks:
      - app-network

  discount_by_age_service:
    build:
      context: ./projects/discount_by_age_service/app
    ports:
      - "8001:8000"
    container_name: discount_by_age_service
    networks:
      - app-network

  discount_by_city_service:
    build:
      context: ./projects/discount_by_city_service/app
    ports:
      - "8002:8000"
    container_name: discount_by_city_service
    networks:
      - app-network

  userdb:
    image: postgres:16
    container_name: userdb
    environment:
      POSTGRES_USER: userpostgres
      POSTGRES_PASSWORD: userpassword
      POSTGRES_DB: userdb
    ports:
      - "5432:5432"
    volumes:
      - userdb_data:/var/lib/postgresql/data
    networks:
      - app-network
  scoredb:
    image: postgres:16
    container_name: scoredb
    environment:
      POSTGRES_USER: scorepostgres
      POSTGRES_PASSWORD: scorepassword
      POSTGRES_DB: scoredb
    ports:
      - "5433:5432"
    volumes:
      - scoredb_data:/var/lib/postgresql/data
    networks:
      - app-network
  score-service:
    build: 
      context: ./projects/score_service/app
    environment:
      - DB_URL=postgresql://scorepostgres:scorepassword@scoredb:5432/scoredb
    depends_on:
      - scoredb
    ports:
      - "8003:8000"
    networks:
      - app-network
  

volumes:
  userdb_data:
  scoredb_data:
  
networks:
  app-network:
    driver: bridge